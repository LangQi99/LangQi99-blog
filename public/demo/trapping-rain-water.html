<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥é›¨æ°´ç®—æ³•å¯è§†åŒ– (åŒæŒ‡é’ˆæ³•)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        canvas {
            touch-action: none;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col items-center p-4">

    <!-- æ ‡é¢˜åŒº -->
    <header class="text-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸŒŠ æ¥é›¨æ°´ç®—æ³•å¯è§†åŒ–</h1>
        <p class="text-gray-600">ä½¿ç”¨ <span class="font-mono bg-gray-200 px-1 rounded text-pink-600">åŒæŒ‡é’ˆæ³• (Two
                Pointers)</span> çš„åŠ¨æ€æ¼”ç¤º</p>
    </header>

    <!-- ä¸»ç•Œé¢å¸ƒå±€ -->
    <main class="w-full max-w-5xl bg-white shadow-xl rounded-2xl overflow-hidden flex flex-col lg:flex-row">

        <!-- å·¦ä¾§ï¼šå¯è§†åŒ–ç”»å¸ƒ -->
        <div class="flex-1 p-6 relative bg-gray-900 flex flex-col items-center justify-center min-h-[400px]">
            <canvas id="visualizer" width="800" height="400" class="w-full h-full object-contain"></canvas>

            <!-- å›¾ä¾‹ -->
            <div
                class="absolute top-4 right-4 bg-gray-800/80 p-3 rounded-lg text-xs text-white backdrop-blur-sm border border-gray-700">
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 bg-gray-400 block"></span> æŸ±å­ (Height)
                </div>
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 bg-blue-500 block"></span> é›¨æ°´ (Water)
                </div>
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 bg-red-500 block"></span> å·¦æŒ‡é’ˆ (Left)
                </div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 bg-green-500 block"></span> å³æŒ‡é’ˆ (Right)</div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ§åˆ¶ä¸è§£é‡Š -->
        <div class="w-full lg:w-96 border-l border-gray-200 flex flex-col">

            <!-- çŠ¶æ€é¢æ¿ -->
            <div class="p-6 bg-blue-50 border-b border-blue-100">
                <h2 class="text-lg font-bold text-blue-800 mb-4">å½“å‰çŠ¶æ€</h2>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="bg-white p-3 rounded shadow-sm">
                        <div class="text-gray-500">å·¦ä¾§æœ€é«˜ (LeftMax)</div>
                        <div class="text-2xl font-mono font-bold text-red-600" id="stat-lmax">0</div>
                    </div>
                    <div class="bg-white p-3 rounded shadow-sm">
                        <div class="text-gray-500">å³ä¾§æœ€é«˜ (RightMax)</div>
                        <div class="text-2xl font-mono font-bold text-green-600" id="stat-rmax">0</div>
                    </div>
                    <div class="bg-white p-3 rounded shadow-sm col-span-2 border-l-4 border-blue-500">
                        <div class="text-gray-500">å½“å‰æ¥æ°´æ€»é‡ (Total)</div>
                        <div class="text-3xl font-mono font-bold text-blue-600" id="stat-total">0</div>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤è§£é‡Š -->
            <div class="flex-1 p-6 overflow-y-auto max-h-[300px] bg-white">
                <h3 class="font-bold text-gray-700 mb-2">ç®—æ³•é€»è¾‘è®²è§£:</h3>
                <div id="log-container" class="space-y-3 text-sm">
                    <div class="p-3 bg-gray-100 rounded border border-gray-200 text-gray-500 italic">
                        ç‚¹å‡»â€œå¼€å§‹æ¼”ç¤ºâ€æˆ–â€œå•æ­¥æ‰§è¡Œâ€å¼€å§‹...
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="p-6 bg-gray-50 border-t border-gray-200">
                <div class="flex flex-wrap gap-2 justify-center">
                    <button onclick="viz.reset()"
                        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded transition font-medium">é‡ç½®æ•°æ®</button>
                    <button id="btn-play" onclick="viz.togglePlay()"
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded shadow transition font-bold flex items-center gap-2">
                        <span id="icon-play">â–¶</span> è‡ªåŠ¨æ’­æ”¾
                    </button>
                    <button onclick="viz.step()"
                        class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded transition">å•æ­¥æ‰§è¡Œ</button>
                </div>

                <div class="mt-4 flex items-center gap-3">
                    <span class="text-xs text-gray-500">é€Ÿåº¦:</span>
                    <input type="range" min="100" max="2000" step="100" value="800" id="speed-range"
                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
        </div>
    </main>

    <!-- ä»£ç å‚è€ƒ -->
    <section class="mt-8 max-w-5xl w-full">
        <div class="bg-gray-800 text-gray-300 rounded-lg p-6 shadow-lg overflow-x-auto">
            <h3 class="text-white font-bold mb-4 border-b border-gray-700 pb-2">æ ¸å¿ƒç®—æ³•ä»£ç  (JavaScript)</h3>
            <pre class="font-mono text-sm leading-relaxed"><code class="language-javascript"><span class="text-pink-400">let</span> left = 0, right = height.length - 1;
<span class="text-pink-400">let</span> leftMax = 0, rightMax = 0;
<span class="text-pink-400">let</span> ans = 0;

<span class="text-blue-400">while</span> (left < right) {
    leftMax = Math.max(leftMax, height[left]);
    rightMax = Math.max(rightMax, height[right]);

    <span class="text-gray-500">// è°å°ç§»è°ï¼Œè¿™æ˜¯æ ¸å¿ƒé€»è¾‘</span>
    <span class="text-blue-400">if</span> (height[left] < height[right]) {
        ans += leftMax - height[left]; <span class="text-green-400">// å·¦è¾¹çŸ®ï¼Œç“¶é¢ˆåœ¨å·¦è¾¹ï¼Œæ­¤æ—¶å³è¾¹å¿…æœ‰é«˜å¢™æŒ¡æ°´</span>
        left++;
    } <span class="text-blue-400">else</span> {
        ans += rightMax - height[right];
        right--;
    }
}</code></pre>
        </div>
    </section>

    <script>
        class RainWaterVisualizer {
            constructor() {
                this.canvas = document.getElementById('visualizer');
                this.ctx = this.canvas.getContext('2d');
                this.logContainer = document.getElementById('log-container');

                // é…ç½®
                this.barWidth = 40;
                this.gap = 5;
                this.data = [];
                this.water = []; // å­˜å‚¨æ¯ä¸ªä½ç½®çš„æ°´é‡

                // çŠ¶æ€
                this.left = 0;
                this.right = 0;
                this.leftMax = 0;
                this.rightMax = 0;
                this.totalWater = 0;
                this.isFinished = false;
                this.isPlaying = false;
                this.timer = null;
                this.speed = 800;

                // ç›‘å¬é€Ÿåº¦æ¡
                document.getElementById('speed-range').addEventListener('input', (e) => {
                    this.speed = 2100 - e.target.value; // åè½¬ï¼šå€¼è¶Šå¤§é€Ÿåº¦è¶Šå¿«(é—´éš”è¶Šå°)
                    if (this.isPlaying) {
                        this.pause();
                        this.play();
                    }
                });

                this.reset();
                this.adjustCanvasSize();
                window.addEventListener('resize', () => this.adjustCanvasSize());
            }

            // åˆå§‹åŒ–éšæœºæ•°æ®
            generateData() {
                // ç»å…¸æµ‹è¯•ç”¨ä¾‹å½¢çŠ¶ï¼Œç¨å¾®éšæœºåŒ–
                const basePattern = [0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1];
                this.data = [];
                for (let i = 0; i < 15; i++) {
                    // éšæœºé«˜åº¦ 0-6
                    this.data.push(Math.floor(Math.random() * 6));
                }
                // ç¡®ä¿ä¸¤ç«¯ä¸æ˜¯æé«˜ï¼Œè§†è§‰ä¸Šå¥½çœ‹ç‚¹
                if (this.data[0] > 2) this.data[0] = 1;
                if (this.data[this.data.length - 1] > 2) this.data[this.data.length - 1] = 1;
            }

            reset() {
                this.pause();
                this.generateData();
                this.water = new Array(this.data.length).fill(0);
                this.left = 0;
                this.right = this.data.length - 1;
                this.leftMax = 0;
                this.rightMax = 0;
                this.totalWater = 0;
                this.isFinished = false;

                this.updateStats();
                this.log("ç³»ç»Ÿ", "æ•°æ®å·²é‡ç½®ã€‚å‡†å¤‡å¼€å§‹...", "neutral");
                this.draw();
            }

            adjustCanvasSize() {
                const parent = this.canvas.parentElement;
                this.canvas.width = parent.clientWidth;
                this.canvas.height = parent.clientHeight;
                this.draw();
            }

            togglePlay() {
                if (this.isPlaying) this.pause();
                else this.play();
            }

            play() {
                if (this.isFinished) return;
                this.isPlaying = true;
                document.getElementById('btn-play').innerHTML = '<span class="font-bold">||</span> æš‚åœ';
                document.getElementById('btn-play').classList.replace('bg-blue-600', 'bg-yellow-500');
                document.getElementById('btn-play').classList.replace('hover:bg-blue-700', 'hover:bg-yellow-600');

                const loop = () => {
                    this.step();
                    if (this.isPlaying && !this.isFinished) {
                        this.timer = setTimeout(loop, this.speed);
                    } else {
                        this.pause();
                    }
                };
                loop();
            }

            pause() {
                this.isPlaying = false;
                clearTimeout(this.timer);
                document.getElementById('btn-play').innerHTML = '<span>â–¶</span> ç»§ç»­æ’­æ”¾';
                document.getElementById('btn-play').classList.replace('bg-yellow-500', 'bg-blue-600');
                document.getElementById('btn-play').classList.replace('hover:bg-yellow-600', 'hover:bg-blue-700');
            }

            step() {
                if (this.isFinished) return;

                // æ ¸å¿ƒç®—æ³•é€»è¾‘
                if (this.left <= this.right) {
                    // æ›´æ–°æœ€å¤§å€¼æ˜¾ç¤º
                    const hLeft = this.data[this.left];
                    const hRight = this.data[this.right];

                    this.leftMax = Math.max(this.leftMax, hLeft);
                    this.rightMax = Math.max(this.rightMax, hRight);

                    let msg = "";
                    let type = "info";

                    // æ¯”è¾ƒå·¦å³é«˜åº¦ï¼Œå†³å®šå¤„ç†å“ªä¸€è¾¹
                    if (hLeft < hRight) {
                        // å¤„ç†å·¦è¾¹
                        const amount = this.leftMax - hLeft;
                        if (amount > 0) {
                            this.water[this.left] = amount;
                            this.totalWater += amount;
                            msg = `å·¦ä¾§(${hLeft}) < å³ä¾§(${hRight})ã€‚å·¦ä¾§å½¢æˆä½æ´¼ã€‚<br>å·¦å¢™æœ€å¤§(${this.leftMax}) - å½“å‰(${hLeft}) = æ¥æ°´ <b class="text-blue-600">${amount}</b>`;
                            type = "success";
                        } else {
                            msg = `å·¦ä¾§(${hLeft}) < å³ä¾§(${hRight})ã€‚<br>æ›´æ–°å·¦ä¾§æœ€å¤§å€¼ä¸º ${this.leftMax}ã€‚æ— æ³•æ¥æ°´ã€‚`;
                        }
                        this.left++;
                    } else {
                        // å¤„ç†å³è¾¹
                        const amount = this.rightMax - hRight;
                        if (amount > 0) {
                            this.water[this.right] = amount;
                            this.totalWater += amount;
                            msg = `å³ä¾§(${hRight}) <= å·¦ä¾§(${hLeft})ã€‚å³ä¾§å½¢æˆä½æ´¼ã€‚<br>å³å¢™æœ€å¤§(${this.rightMax}) - å½“å‰(${hRight}) = æ¥æ°´ <b class="text-blue-600">${amount}</b>`;
                            type = "success";
                        } else {
                            msg = `å³ä¾§(${hRight}) <= å·¦ä¾§(${hLeft})ã€‚<br>æ›´æ–°å³ä¾§æœ€å¤§å€¼ä¸º ${this.rightMax}ã€‚æ— æ³•æ¥æ°´ã€‚`;
                        }
                        this.right--;
                    }

                    this.log("è®¡ç®—ä¸­", msg, type);
                    this.updateStats();
                    this.draw();
                } else {
                    this.isFinished = true;
                    this.log("å®Œæˆ", `è®¡ç®—ç»“æŸï¼æ€»æ¥æ°´é‡ä¸º: ${this.totalWater}`, "finish");
                    this.draw();
                }
            }

            log(title, content, type) {
                const div = document.createElement('div');
                let borderClass = 'border-l-4 border-gray-400';
                let bgClass = 'bg-gray-50';

                if (type === 'success') { borderClass = 'border-l-4 border-blue-500'; bgClass = 'bg-blue-50'; }
                if (type === 'finish') { borderClass = 'border-l-4 border-green-500'; bgClass = 'bg-green-50'; }

                div.className = `p-3 rounded shadow-sm text-sm mb-2 animate-fade-in ${borderClass} ${bgClass}`;
                div.innerHTML = `<div class="font-bold text-gray-700 text-xs mb-1">${title}</div><div class="text-gray-600 leading-snug">${content}</div>`;

                this.logContainer.prepend(div);
                // ä¿æŒæœ€å¤šæ˜¾ç¤º50æ¡
                if (this.logContainer.children.length > 50) {
                    this.logContainer.lastChild.remove();
                }
            }

            updateStats() {
                document.getElementById('stat-lmax').innerText = this.leftMax;
                document.getElementById('stat-rmax').innerText = this.rightMax;
                document.getElementById('stat-total').innerText = this.totalWater;
            }

            draw() {
                const w = this.canvas.width;
                const h = this.canvas.height;
                const ctx = this.ctx;

                ctx.clearRect(0, 0, w, h);

                // è®¡ç®—ç»˜åˆ¶å‚æ•°
                const n = this.data.length;
                const maxVal = Math.max(6, ...this.data) + 2; // Yè½´æœ€å¤§å€¼ï¼Œç•™ç‚¹ç©ºé—´

                // åŠ¨æ€è®¡ç®—æŸ±å­å®½åº¦ï¼Œå±…ä¸­
                const availWidth = w - 60; // å·¦å³ç•™ç™½
                const itemW = availWidth / n;
                const barW = itemW * 0.7; // æŸ±å­å 70%
                const gap = itemW * 0.3;
                const startX = 30;

                const unitH = (h - 60) / maxVal; // åº•éƒ¨ç•™ç™½

                // ç»˜åˆ¶åŸºçº¿
                ctx.beginPath();
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;
                ctx.moveTo(10, h - 30);
                ctx.lineTo(w - 10, h - 30);
                ctx.stroke();

                for (let i = 0; i < n; i++) {
                    const x = startX + i * itemW + gap / 2;
                    const val = this.data[i];
                    const waterVal = this.water[i] || 0;

                    const barHeight = val * unitH;
                    const waterHeight = waterVal * unitH;
                    const yBase = h - 30;

                    // 1. ç»˜åˆ¶æŸ±å­
                    ctx.fillStyle = '#9CA3AF'; // é»˜è®¤ç°è‰²

                    // é«˜äº®æ­£åœ¨å¤„ç†çš„æŸ±å­ (å¦‚æœæ˜¯å½“å‰leftæˆ–right)
                    // æ³¨æ„ï¼šç”±äºstepä¸­å…ˆå¢åŠ left/rightï¼Œæ‰€ä»¥å®é™…ä¸Šå¯è§†åŒ–çš„å½“å‰æŒ‡é’ˆéœ€è¦å¾®è°ƒé€»è¾‘
                    // ç®€å•èµ·è§ï¼Œå¦‚æœ i ç­‰äº left æˆ– rightï¼Œç»™ç‰¹æ®Šé¢œè‰²
                    let isPointer = false;
                    if (!this.isFinished) {
                        if (i === this.left) {
                            ctx.fillStyle = '#EF4444'; // Red for left
                            isPointer = true;
                        } else if (i === this.right) {
                            ctx.fillStyle = '#10B981'; // Green for right
                            isPointer = true;
                        }
                    }

                    // æŸ±å­çŸ©å½¢
                    ctx.fillRect(x, yBase - barHeight, barW, barHeight);

                    // æŸ±å­æ–‡å­—
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    if (val > 0) ctx.fillText(val, x + barW / 2, yBase - 5);

                    // ç´¢å¼•æ–‡å­—
                    ctx.fillStyle = '#6B7280';
                    ctx.font = '10px Arial';
                    ctx.fillText(i, x + barW / 2, yBase + 15);

                    // 2. ç»˜åˆ¶æ°´
                    if (waterVal > 0) {
                        ctx.fillStyle = 'rgba(59, 130, 246, 0.8)'; // Blue
                        ctx.fillRect(x, yBase - barHeight - waterHeight, barW, waterHeight);

                        // æ°´é‡æ–‡å­—
                        ctx.fillStyle = '#fff';
                        ctx.font = 'bold 12px Arial';
                        ctx.fillText(`+${waterVal}`, x + barW / 2, yBase - barHeight - waterHeight / 2 + 4);
                    }

                    // 3. ç»˜åˆ¶æŒ‡é’ˆæ ‡è®° (ç®­å¤´æ•ˆæœ)
                    if (isPointer) {
                        ctx.beginPath();
                        ctx.moveTo(x + barW / 2, yBase + 20);
                        ctx.lineTo(x + barW / 2 - 5, yBase + 30);
                        ctx.lineTo(x + barW / 2 + 5, yBase + 30);
                        ctx.fillStyle = i === this.left ? '#EF4444' : '#10B981';
                        ctx.fill();

                        ctx.font = 'bold 14px Arial';
                        ctx.fillText(i === this.left ? 'L' : 'R', x + barW / 2, yBase + 45);
                    }
                }
            }
        }

        // å¯åŠ¨
        const viz = new RainWaterVisualizer();
    </script>
</body>

</html>