---
import { Icon } from "astro-icon/components";
import ThemeToggle from "./widgets/ThemeToggle.astro";
import { SITE_TITLE, SITE_MENU, USER_AVATAR } from "../config";

// Get current path to determine active link
const currentPath = Astro.url.pathname;

// Type safely process SITE_MENU before rendering
type SubMenuItem = {
  id: string;
  text: string;
  href: string;
  svg: string;
  target?: string;
};

type MenuItem = {
  id: string;
  text: string;
  href: string;
  svg: string;
  target?: string;
  subItems?: SubMenuItem[];
};

// Ensure the menu is properly typed
const typedMenu = SITE_MENU as MenuItem[];
---

<nav class="sticky top-0 z-50 w-full bg-white border-b border-gray-200">
  <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between font-mono text-sm">
    <!-- Terminal Prompt / Home -->
    <a href="/" class="flex items-center gap-2 hover:bg-gray-100 px-3 py-1 rounded transition-colors duration-200">
      <span class="text-green-600 font-bold">âžœ</span>
      <span class="text-blue-600 font-bold">~</span>
      <span class="text-gray-600">/</span>
      <span class="font-bold text-gray-800">blog</span>
    </a>

    <!-- Navigation Links as Terminal Commands -->
    <div class="hidden md:flex items-center gap-4">
      {
        typedMenu.map((item) => (
          <a
            href={item.href}
            target={item.target || "_self"}
            class:list={[
              "px-2 py-1 hover:text-black transition-colors duration-200",
              currentPath === item.href ? "text-black font-bold bg-gray-100 rounded" : "text-gray-500",
            ]}
          >
            [{item.text ? item.text.toLowerCase() : ""}]
          </a>
        ))
      }
    </div>

    <!-- Mobile Menu Icon (Simple fallback) -->
    <div class="md:hidden flex items-center">
        <!-- Minimal mobile menu specific for IDE theme -->
         <details class="dropdown dropdown-end">
          <summary class="btn btn-ghost btn-xs font-mono text-gray-500">// menu</summary>
          <ul class="p-2 shadow menu dropdown-content z-[1] bg-base-100 rounded-box w-52 border border-gray-200">
             {
                typedMenu.map((item) => (
                  <li>
                    <a href={item.href} class={currentPath === item.href ? "active font-bold" : ""}>
                      {item.text}
                    </a>
                  </li>
                ))
              }
          </ul>
        </details>
    </div>

    <!-- Right Controls -->
    <div class="flex items-center gap-3">
      {/* Avatar Widget */}
      <a href="/about" class="avatar w-8 h-8 rounded-full overflow-hidden border border-gray-300 hover:border-black transition-colors">
         <img src={USER_AVATAR || "/favicon.svg"} alt="User Avatar" class="w-full h-full object-cover" />
      </a>
      <ThemeToggle className="hover:bg-gray-100 p-1 rounded" />
    </div>
  </div>
</nav>
