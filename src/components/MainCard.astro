---
import { t } from "@config";
import { Icon } from "astro-icon/components";
import Card from "@/components/temple/Card.astro";
import { Image } from "astro:assets";
import type { PostData } from "@interfaces/data";

export interface MainCardProps extends PostData {
  infoIcon?: string; // Icon for the info button
  helpText?: string; // Custom help text (defaults to "Learn More")
  textOverlay?: string; // Text to overlay on background when no image
  showTextBackground?: boolean; // Show text background when no image
  headerClass?: string; // Additional classes for the header
  extraClasses?: string; // Additional classes for the whole card
}

const {
  title,
  description,
  image,
  infoIcon = "lucide:help-circle",
  helpText = t("label.learnMore"),
  textOverlay,
  showTextBackground = true,
  headerClass = "",
  extraClasses = "",
} = Astro.props as MainCardProps;

// Create a more descriptive label for the button
const accessibleHelpText = `${helpText}: ${title}`;
---

<Card class={`overflow-hidden ${extraClasses}`} title={title ? `~/posts/${title.toLowerCase().replace(/\s+/g, '-')}.md` : '~/untitled.md'}>
  {
    image ? (
      // With image - show image with overlay title
      <div class="relative">
        <div class="aspect-video w-full overflow-hidden border-b border-gray-200">
          <Image
            src={image}
            alt={title}
            width={1200}
            height={630}
            format="webp"
            loading="eager"
            class="w-full h-full object-cover"
          />
        </div>

        <div class="absolute bottom-4 left-4 lg:bottom-6 lg:left-6">
          <div class="inline-block bg-black/80 px-4 py-2 border border-white/20 shadow-none">
            <h1 class="text-xl sm:text-2xl lg:text-4xl font-bold text-white font-mono">{title}</h1>
          </div>
        </div>

        {description && (
          <div class="absolute bottom-4 right-4 lg:bottom-6 lg:right-6">
             {/* Simplified tooltip for IDE theme */}
             <div class="dropdown dropdown-top dropdown-end dropdown-hover">
               <label tabindex="0" class="btn btn-sm btn-square rounded-none border border-gray-500 bg-gray-900 text-white hover:bg-black">
                 <Icon name={infoIcon} class="w-4 h-4" />
               </label>
               <div tabindex="0" class="dropdown-content z-[1] p-2 shadow-sm bg-gray-900 text-white border border-gray-700 w-64 text-xs font-mono mb-2">
                 {description}
               </div>
             </div>
          </div>
        )}
      </div>
    ) : textOverlay ? (
      // No image, but with textOverlay - show simple gray bg
      <div class="relative">
        <div class={`aspect-video w-full overflow-hidden bg-gray-100 border-b border-gray-200 flex items-center justify-center ${headerClass}`}>
             <span class="text-4xl md:text-6xl font-bold text-gray-200 font-mono select-none">
                {textOverlay}
             </span>
        </div>

        <div class="absolute bottom-4 left-4">
            <h1 class="text-xl sm:text-2xl lg:text-4xl font-bold text-black font-mono bg-white/80 px-2 border border-gray-200">{title}</h1>
        </div>
      </div>
    ) : (
      // No image, no textOverlay - show simple title and description at top
      <div class="pt-6 px-6 border-b border-gray-100 pb-4">
        <h1 class="text-xl sm:text-2xl lg:text-4xl font-bold font-mono">{title}</h1>
        {description && <p class="mt-2 text-sm text-gray-500 font-mono"> // {description}</p>}
      </div>
    )
  }

  <!-- Content section -->
  <div class="p-4 sm:p-6 font-mono">
    <slot />
  </div>
</Card>

<script>
  document.addEventListener("astro:page-load", () => {
    // Get all info buttons and dropdown contents
    const infoButtons = document.querySelectorAll(".dropdown label");
    const dropdownContents = document.querySelectorAll(".dropdown-content");

    // Add click event listeners
    infoButtons.forEach((button, index) => {
      button.addEventListener("click", () => {
        const content = dropdownContents[index];
        const currentState = content.getAttribute("data-state");

        // Toggle state
        if (currentState === "closed") {
          content.setAttribute("data-state", "open");
          // Add animation classes when opening
          content.classList.add("scale-100", "opacity-100");
          content.classList.remove("scale-90", "opacity-0");
        } else {
          content.setAttribute("data-state", "closed");
          // Remove animation classes when closing
          content.classList.add("scale-90", "opacity-0");
          content.classList.remove("scale-100", "opacity-100");
        }
      });
    });
  });
</script>
