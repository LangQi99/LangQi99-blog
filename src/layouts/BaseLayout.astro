---
import "medium-zoom/dist/style.css";
import { SITE_TAB, SITE_DESCRIPTION, SITE_FAVICON, SITE_LANGUAGE, SITE_THEME } from "@config";
import { ClientRouter } from "astro:transitions";
import ElementCrossing from "astro-vtbot/components/ElementCrossing.astro";
import PointerOnNavigation from "astro-vtbot/components/PointerOnNavigation.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Navbar from "@components/Navbar.astro";
import MobileTOC from "@components/widgets/MobileTOC.astro";

const { title, image, headings = [], showTOC = false } = Astro.props;
---

<!doctype html>
<html lang={SITE_LANGUAGE} class="bg-white" data-theme="light">
  <head>
    <ClientRouter />
    <ElementCrossing />
    <PointerOnNavigation />
    <Header description={SITE_DESCRIPTION} favicon={SITE_FAVICON} image={image} />
    <title>{`${title} - ${SITE_TAB}`}</title>

    {/* Theme persistence script - kept minimal as we are forcing light/IDE theme but might want dark mode later */}
    <script define:vars={{ SITE_THEME }} is:inline>
      (function () {
        const storedTheme = localStorage.getItem("theme");
         // Default to light for IDE theme
        let theme = storedTheme || 'light';
        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
  </head>
  <body class="bg-white font-mono text-gray-800 antialiased min-h-screen flex flex-col">
    <!-- Top Navbar -->
    <Navbar />

    <div class="flex-grow w-full max-w-5xl mx-auto px-4 py-8">
        <main class="w-full">
           <slot />
        </main>
    </div>
    
    <div class="max-w-5xl mx-auto w-full px-4">
        <Footer />
    </div>

    <!-- Mobile TOC Button (only visible on mobile if needed) -->
    <MobileTOC headings={headings} showTOC={showTOC} />

    <!-- Code copy functionality -->
    <script is:inline>
      document.addEventListener("astro:page-load", () => {
        document.querySelectorAll(".btn-copy").forEach((button) => {
          button.addEventListener("click", async () => {
            const codeBlock = button.closest(".frosti-code");
            const code = codeBlock.querySelector("code").textContent;
            const copyIcon = button.querySelector(".frosti-code-toolbar-copy-icon");
            const successIcon = button.querySelector(".frosti-code-toolbar-copy-success");

            try {
              await navigator.clipboard.writeText(code);
              copyIcon.classList.add("hidden");
              successIcon.classList.remove("hidden");
              button.classList.add("copy-success");
              setTimeout(() => {
                copyIcon.classList.remove("hidden");
                successIcon.classList.add("hidden");
                button.classList.remove("copy-success");
              }, 2000);
            } catch (err) {
              console.error("Failed to copy:", err);
            }
          });
        });
      });
    </script>

    <style is:inline>
      .btn-copy { position: relative; overflow: hidden; }
      .copy-success { animation: pulse 0.5s ease-in-out; }
      .frosti-code-toolbar-copy-success svg { color: #10b981; }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
    </style>
  </body>
</html>
