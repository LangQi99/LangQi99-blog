---
import type { Post, Page } from "@interfaces/data";
import PostCard from "@components/PostCard.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import Pagination from "@components/widgets/Pagination.astro";
import CardGroup from "@components/temple/CardGroup.astro";
import { Icon } from "astro-icon/components";
import { t } from "@config";
import { generatePageLinks } from "@utils/blogUtils";
import { getMainBlogPaginationPaths } from "@utils/paginationUtils";

export async function getStaticPaths({ paginate }: { paginate: any }) {
  return getMainBlogPaginationPaths({ paginate });
}

const { page }: { page: Page } = Astro.props;

const totalPages = Math.ceil(page.total / page.size);
const pageLinks = generatePageLinks(totalPages);
---

<BaseLayout title="Blog">
  <!-- Command Line Toolbar -->
  <div class="flex flex-wrap items-center gap-4 mb-8 bg-gray-50/80 backdrop-blur-sm p-4 rounded-md border border-gray-200 transition-all duration-300">
    <div class="font-mono text-sm text-gray-500 mr-2">$ ./blog_tools.sh</div>
    
    <!-- Archives -->
    <a href="/blog/archives" class="group flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded hover:border-accent hover:shadow-sm transition-all duration-200">
      <span class="text-accent font-bold group-hover:text-accent-focus">$</span>
      <span class="font-mono text-sm text-gray-700 group-hover:text-black">ls -R /archives</span>
    </a>

    <!-- Categories -->
    <a href="/blog/categories" class="group flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded hover:border-primary hover:shadow-sm transition-all duration-200">
      <span class="text-primary font-bold group-hover:text-primary-focus">#</span>
      <span class="font-mono text-sm text-gray-700 group-hover:text-black">find /categories</span>
    </a>

    <!-- Tags -->
    <a href="/blog/tags" class="group flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded hover:border-secondary hover:shadow-sm transition-all duration-200">
      <span class="text-secondary font-bold group-hover:text-secondary-focus">@</span>
      <span class="font-mono text-sm text-gray-700 group-hover:text-black">cat /tags</span>
    </a>

    <!-- Search -->
    <a href="/blog/search" class="group flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 rounded hover:border-info hover:shadow-sm transition-all duration-200">
      <Icon name="lucide:search" class="w-4 h-4 text-gray-400 group-hover:text-info" />
      <span class="font-mono text-sm text-gray-700 group-hover:text-black">grep</span>
    </a>
  </div>

  <!-- Blog Post List -->
  <CardGroup cols="1" gap="6">
    {
      page.data.map((blog: Post) => (
        <PostCard
          title={blog.data.title}
          image={blog.data.image}
          description={blog.data.description}
          url={"/blog/" + blog.slug}
          pubDate={blog.data.pubDate}
          badge={blog.data.badge}
          categories={blog.data.categories}
          tags={blog.data.tags}
          word={blog.remarkPluginFrontmatter.totalCharCount}
          time={blog.remarkPluginFrontmatter.readingTime}
        />
      ))
    }
  </CardGroup>
  <Pagination page={page} totalPages={totalPages} pageLinks={pageLinks} baseUrl={`/blog`} />
</BaseLayout>
